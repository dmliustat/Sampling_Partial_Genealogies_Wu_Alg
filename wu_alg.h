double calc_Wu(long* TYPE, long* ntype);